# 4. Presto 技术架构

在前面的章节介绍了 Presto 以及进行了初始安装和使用之后，我们现在讨论 Presto 架构。 我们将深入探讨相关概念，因此您可以了解 Presto 查询执行模型，查询计划和基于代价的优化器。

在本章中，我们首先讨论 Presto 高级架构组件。大致了解 Presto 的工作方式非常重要，特别是如果您打算自己安装和管理 Presto 集群，如第5章所述。

在本章的下半部分，当我们讨论 Presto 的查询执行模型时，我们将更深入地研究这些组件。 如果您需要诊断或调优性能低下的查询（在第8章中进行了讨论），或者您打算为 Presto 开源项目做出贡献，那么这是非常重要的。

## 集群中的 Coordinator 和 Worker

如第2章中所述，首次安装 Presto 时，仅使用一台计算机来运行。这种部署方式无法满足可伸缩性和性能的要求。

Presto 是一个分布式 SQL 查询引擎，类似于大规模并行处理（MPP）的数据库和查询引擎。它无需依赖于运行 Presto 的服务器的垂直扩展，而是能够以水平方式在服务器集群中分布所有处理。这意味着用户可以添加更多节点以获得更多处理能力。

利用这种体系结构，Presto 查询引擎能够跨集群或节点并行处理大数据量的 SQL 查询。 Presto 在每个节点上作为单服务进程运行。运行 Presto 的多个节点（配置为彼此协作）组成一个 Presto 集群。

图4-1描述了由一个协调节点和多个工作节点组成的 Presto 群集。 Presto 用户通过客户端连接到协调节点，例如使用 JDBC 驱动程序或 Presto CLI 工具。然后，协调节点与工作节点协作，工作节点访问数据源。

![&#x56FE; 4-1](../.gitbook/assets/image%20%284%29.png)

协调节点（coordinator）负责接收所有的查询，并且管理工作节点去执行查询。

工作节点（worker）负责执行任务并且处理数据。

发现服务（discovery service）通常运行在协调节点上，允许工作节点注册并参与到集群中。

所有节点、客户端之间的通信使用了基于 HTTP/HTTPS 的 REST 协议。

图 4-2 展示了节点间是如何通信的。协调节点与工作节点通信，以分配任务，更新状态，获取最外层的结果返回给用户。工作节点之间也会互相通信，以获取来自其他节点的上游任务的数据。所有的节点都可以从数据源抽取数据。

![&#x56FE; 4-2](../.gitbook/assets/image%20%287%29.png)

## Coordinator 协调节点



## Discovery Service 发现服务

## Worker 工作节点

## 基于 Connector 的架构

## Catalogs，Schemas 和 Tables

## 查询执行模型

## 查询计划

## 优化规则

## 执行规则

## 基于代价的优化器

## 处理表分析

## 总结



